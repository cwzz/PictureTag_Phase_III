<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">

    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

    <title>众包标注平台首页项目详细信息</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" type="text/css" media="all">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="/css/queries.css" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" integrity="sha384-DmABxgPhJN5jlTwituIyzIUk6oqyzf3+XuP7q3VfcWA2unxgim7OSSZKKf0KSsnh" crossorigin="anonymous">
    <link href="/css/carousel.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/default.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/css.css" type="text/css" media="all">
    <link rel="stylesheet" type='text/css' href="/css/log.css">
    <link rel="stylesheet" type='text/css' href="/css/ProjectDetailPageStyle.css">
    <link rel="stylesheet" type="text/css" href="/css/out-lib/demand_detail.css">
    <link rel="stylesheet" href="/css/rippler.css">
    <link rel="stylesheet" href="/css/bars-1to10.css">
    <link rel="stylesheet" type="text/css" href="/css/out-style.css">
    <link rel="stylesheet" type="text/css" href="/css/style-responsive.css">
    <link rel="stylesheet" type="text/css" href="/css/line-icons.css">
    <link href="/css/elegant-icons-style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" integrity="sha384-DmABxgPhJN5jlTwituIyzIUk6oqyzf3+XuP7q3VfcWA2unxgim7OSSZKKf0KSsnh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/jquery-confirm.css" />

    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="/js/modernizr.min.js"></script>
    <script src="/js/jquery.js"></script>
    <script src="/js/jquery.easing.1.3.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/classie.js"></script>
    <script src="js/jquery.rippler.js"></script>
    <script src="/js/jquery.barrating.js"></script>
    <script src="/js/examples.js"></script>
    <script type="text/javascript" src="/js/jquery-confirm.js"></script>

    <style>
        article, aside, dialog, figure, footer, header, hgroup, menu, nav, section { display: block; }
        .photo_box2{display: none}
        .photo_box3{display: none}
    </style>

</head>
<body style="background:#ffffff">

<div class="navbar navbar-fixed-top skrollable skrollable-between" role="navigation"
     style="line-height:60px; height:80px; background-color:rgba(255, 255, 255, 0.8);">
    <div class="container">
        <div class="navbar-header" style="margin-top: 22px">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="fa fa-bars color-white"></span>
            </button>
            <p style="font-size:2em;margin: 0.67em 0;color: #353535">众包标注平台<a class="navbar-brand skrollable skrollable-between" href="<%=basePath%>"
                                                                              style="display:none;margin-top:5px;"></a>
            </p>
        </div>

        <ul class="menu nav navbar-nav skrollable skrollable-between nnav"
            style="margin-top:22px;display:inline;left: 48%;position: absolute;" >
            <li><a href="/cwzz/introduce">首页</a>
                <ul class="submenu">
                    <li><a href="/introduce">网站介绍</a></li>
                    <!--<li><a href="<%=basePath%>/market/market">大盘概览</a></li>-->
                </ul>
            </li>
            <li><a href="/cwzz/home">项目</a>
                <ul class="submenu">
                    <li><a href="/cwzz/home">项目大厅</a></li>
                    <li><a href="/cwzz/upload">发布项目</a></li>
                </ul>
            </li>
            <li><a href="/cwzz/personal_center">个人</a>
                <ul class="submenu">
                    <li><a href="/cwzz/personal_center">个人信息</a></li>
                    <li><a href="/cwzz/personal_center">任务详情</a></li>
                </ul>
            </li>
            <li><a href="<%=basePath%>/help">帮助</a>
                <ul class="submenu">
                    <li><a href="<%=basePath%>/help">详情咨询</a></li>
                    <li><a href="<%=basePath%>/aboutus">关于我们</a></li>
                </ul>
            </li>
        </ul>

        <div class="top-nav notification-row" style="margin-left: 0px;margin-top: 0px;display: inline-block;position: absolute;left:85%">
            <!-- notificatoin dropdown start-->
            <ul class="nav pull-right top-menu">
                <!-- alert notification start-->
                <li id="alert_notificatoin_bar" class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#" id="bell">

                        <i class="icon-bell-l"></i>
                        <span class="badge bg-important" id="unread_number" style="display: none"></span>
                    </a>
                    <ul class="dropdown-menu extended notification" id="unread_message_list" style="display: none;">
                        <div class="notify-arrow notify-arrow-blue"></div>
                        <li>
                            <p class="blue" id="howmany"></p>
                        </li>
                    </ul>
                </li>
                <!-- alert notification end-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="profile-ava">
                                <i class="fas fa-user"></i>
                            </span>
                        <span class="username" id="username"></span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <li class="eborder-top">
                            <a href="#"><i class="fas fa-home"></i> 个人中心</a>
                        </li>
                        <li>
                            <a onclick="logout()"><i class="fas fa-sign-out-alt"></i> 登出</a>
                        </li>
                        <li>
                            <a onclick="logout()"><i class="fas fa-exchange-alt"></i> 切换账号</a>
                        </li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!-- notificatoin dropdown end-->
        </div>

    </div>
</div>

<br>
<br>

<div class="index_middle">
    <div class="left" style="width:100%;height:auto;overflow: hidden;background-color:transparent; border-style: none">
        <div class="row" style="display: inline-block;width: 100%;margin-left: 0px;margin-right: 0px">
                <div class="demand_detail">
                    <h3 class="demand_name_h3"><span id="project_name"></span>        <a style="cursor:pointer;" onclick="open_preview()">->点击预览项目图片列表</a></h3>
                    <div class="row" id="zhongbiao_area" style="display: none">
                        <div class="spec_requirement col-md-6" style="width: 50%;margin-bottom: 20px;cursor: pointer;" id="continue_work" onclick="gotoWork()"><a>->继续执行项目</a></div>
                        <button id="submit" class="btn btn-default rippler rippler-inverse col-md-3 commit_project_result" href="#" style=";background: #ffffff;border-color: #1b76d9;margin-top: 5px;margin-bottom: 10px">
                            <span class="glyphicon glyphicon-ok"></span>&nbsp;确认提交项目执行结果
                        </button>
                    </div>
                    <div class="task_number_time">
                        需求号：<span id="project_id"></span>
                        发包方：<span id="project_publisher"></span>
                        发布时间：<span id="project_publish_time"></span>
                        奖励积分：<span id="project_points"></span>
                    </div>
                    <div class="text_shadow_area text_shadow_area1" style="height: 173px">
                        <div class="width_430">分类：<span id="project_type"></span></div>
                        <div class="width_340">需求截止完成时间：<span id="project_bidtime"></span></div>
                        <div class="width_430">剩余完成任务时间：<span id="project_completetime"></span></div>

                        <div class="width_340">联系方式：仅承包方投标后可见</div>

                        <div class="clear"></div>

                        <div class="progress" style="width: 700px;position:absolute;margin-top: 25px;margin-bottom: 25px">
                            <div class="progress-bar"  id="bid_state" style="width: 50px;margin-left: 0px;background:linear-gradient(to right, #55267f 35%, #664187 68%);">
                                <div class="progress-value">发布项目</div>
                            </div>
                            <div class="progress-bar" id="underway_state" style="width:250px;margin-left: 0px;background: transparent;">
                                <div class="progress-value">执行项目</div>
                            </div>
                            <div class="progress-bar" id="comment_state" style="width: 450px;margin-left: 0px;background:transparent;">
                                <div class="progress-value">评估结果</div>
                            </div>
                            <div class="progress-bar" id="complete_state" style="width: 650px;margin-left: 0px;background:transparent;">
                                <div class="progress-value">项目完成</div>
                            </div>
                        </div>

                    </div>
                    <div class="clear" style="height:30px;"></div>
                    <div class="text_shadow_area text_shadow_area2">
                        <div class="spec_requirement">具体需求：</div>
                        <div class="spec_requirement_p" id="project_detailrequire">
                        </div>

                    <!-- 补充需求 -->
                        <div class="spec_requirement">补充说明：</div>
                        <p class="supplementary_demand" id="project_otherrequire"></p>
                        <div class="clear" style="height:10px;"></div>
                        <!-- 付款比例 -->
                        <div class="spec_requirement">阶段奖励说明：</div>
                        <div class="node_table_header">
                            <span>奖励分配节点</span>
                            <span>奖励比例</span>
                            <span>评估结果机制</span>
                            <span>完成截止时间</span>
                        </div>
                        <div class="clear" style="width:760px;height:10px;background:#fff;"></div>
                        <div class="node_table_body">
                            <span>对选定整合结果的贡献达到30%</span>
                            <span>个人平均份额的30%</span>
                            <span>自动化整合+发包方选定</span>
                            <span>项目最终完成截止时间</span>
                        </div>
                        <div class="node_table_body">
                            <span>对选定整合结果的贡献达到70%</span>
                            <span>个人平均份额的70%</span>
                            <span>自动化整合+发包方选定</span>
                            <span>项目最终完成截止时间</span>
                        </div>
                        <div class="node_table_body">
                            <span>对选定整合结果的贡献达到100%</span>
                            <span>个人平均份额的100%</span>
                            <span>自动化整合+发包方选定</span>
                            <span>项目最终完成截止时间</span>
                        </div>
                        <div class="clear" style="width:760px;height:10px;background:#fff;"></div>
                        <div class="clear" style="height:30px;"></div>
                    </div>
                    <div class="clear" style="height:30px;"></div>
                    <!-- 参与投标 -->
                    <div class="text_shadow_area text_shadow_area3" id="person_area">
                        <div class="spec_requirement">承包人员：</div>
                        <div style="width: 96%;margin-left: auto;margin-right: auto;margin-bottom: 20px" id="bid_person_list">
                        </div>
                    </div>
                    <div class="clear" style="height:30px"></div>
                    <div class="text_shadow_area text_shadow_area3" style="display: none" id="project_result">
                        <div class="spec_requirement">工人完成情况预览:</div>
                        <section class="panel" id="publish_pros_list" style="height: 100%;width: 100%;margin-left: 0px;padding-right:20px;background: transparent">
                            <div class="panel-body progress-panel" style="width: 100%">
                                <div class="row">
                                    <div class="col-lg-8 task-progress pull-left">
                                        <h1>工人完成情况列表</h1>
                                    </div>
                                </div>
                            </div>
                            <table class="table table-hover personal-task" id="publish_table">
                                <thead>
                                <tr>
                                    <th scope="col" style="text-align: center;">提交次序</th>
                                    <th scope="col" style="text-align: center;">提交人员</th>
                                    <th scope="col" style="text-align: center;">提交时间</th>
                                    <th scope="col" style="text-align: center;">花费时间</th>
                                </tr>
                                </thead>
                                <tbody id="publish_table_body">
                                </tbody>
                            </table>
                        </section>
                    </div>
                    <div class="clear" style="height:30px"></div>
                    <div class="text_shadow_area text_shadow_area3" style="display: none" id="view_download">
                        <div class="spec_requirement">整合结果:</div>
                        <div class="row" style="padding-left: 15px;display: none" id="view" onclick="integrity()">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px;cursor: pointer'><span>>> 预览整合结果</span></h3>
                        </div>
                        <div class="row" style="padding-left: 15px;display: none;" id="download" onclick="downloadPictures()">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px;cursor: pointer'><span>>> 下载整合结果</span></h3>
                        </div>
                        <div class="row" style="text-align: center;display: none" id="requester_wait">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px'><span>...请耐心等待整合结果...</span></h3>
                        </div>
                        <div class="row">
                            <div class="spec_requirement col-md-3" style="width: 25%;font-size: 10px">对本次整合结果打分（满分10分）：</div>
                            <div class="box-body col-md-6" style="width: 75%;padding-top: 10px">
                                <select id="example-1to10" name="rating">
                                    <option value="1" selected="selected">1分</option>
                                    <option value="2">2分</option>
                                    <option value="3">3分</option>
                                    <option value="4">4分</option>
                                    <option value="5">5分</option>
                                    <option value="6">6分</option>
                                    <option value="7">7分</option>
                                    <option value="8">8分</option>
                                    <option value="9">9分</option>
                                    <option value="10">10分</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-default rippler rippler-inverse commit_assesment_btn" href="#" style="left: 70% ;background: #ffffff;border-color: #1b76d9;margin-bottom: 10px">
                            <span class="glyphicon glyphicon-ok"></span>&nbsp;提交打分结果
                        </button>
                    </div>
                    <div class="clear" style="height:30px"></div>
                    <div class="text_shadow_area text_shadow_area3" style="display: none" id="points_result">
                        <div class="spec_requirement">奖励结果:</div>
                        <div class="row" style="text-align: center;display: none;" id="points">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px'><span id="points_txt">...您本次共获得积分：...</span></h3>
                        </div>
                        <div class="row" style="text-align: center;display: none" id="experience">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px'><span id="experience_txt">...您本次经验值上升：...</span></h3>
                        </div>
                        <div class="row" style="text-align: center;display: none" id="chaoguo">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px'><span id="chaoguo_txt">...您当前已超过：...</span></h3>
                        </div>
                        <div class="row" style="text-align: center;display: none" id="worker_wait">
                            <h3 class="demand_name_h3" style='margin-right: auto;margin-left: auto;padding-bottom: 10px;padding-top: 10px'><span>...请耐心等待整合...</span></h3>
                        </div>
                    </div>
                    <div class="clear" style="height:30px"></div>
                </div>

            <!-- 右侧推荐金主信息，推荐需求 -->
            <div class="demand_rec">
                <div class="immediate_tender_float">
                    <div class="immediate_tender_fixed">
                        <p class="immediate_tender" id="bid_btn" style="cursor: pointer" onclick="bid()">参与承包</p>
                        <p class="bid_attitude" id="show_state"></p>
                    </div>
                </div>
                <!--<div class="clear" style="width:100%;height:1px;background:#e5e5e5;"></div>-->
                <div class="fabaofang" style="padding-left: 0px">
                    <div class="serviceBox">
                        <div class="service-icon" style="height: 100%;top:0%">
                            <i class="fa fa-cart-arrow-down" style="font-size: 50px"></i>
                        </div>
                        <div class="service-Content" style="margin-left: 15px;top:0%;display: inline-block">
                            <h3 class="title" style="margin-top: 0px;margin-bottom: 0px">发包方</h3>
                            <p class="description" style="margin-bottom: 0px;margin-top: 0px" id="publisher_name"></p>
                            <p class="description" style="margin-bottom: 0px;margin-top: 0px">发布项目：<span id="publisher_releasenum"></span></p>
                            <p class="description" style="margin-bottom: 0px;margin-top: 0px">承包项目：<span id="publisher_contractnum"></span></p>
                        </div>
                        <div class="service-Content" style="margin-left: 10px;margin-top: 60px;display: inline-block">
                            <p class="description"><a>了解更多</a></p>
                        </div>
                    </div>
                </div>
                <div class="title">
                    <p>推荐需求</p>
                    <p style="margin-left: 150px"><a href="http://www.rdplat.com/leaderTask/">更多&gt;&gt;</a></p>
                </div>
                <div class="row" style="height: 130px;width: 100%;margin-left: 0px;margin-right: 0px">
                    <div class="col-md-12" style="padding-left: 0px;padding-right: 0px;height: 100%">
                        <div class="serviceBox" style="height: 100%">
                            <div class="service-icon" style="top:0%">
                                <i class="fa fa-tags" style="font-size: 50px"></i>
                            </div>
                            <div class="service-Content" style="margin-top:0px;margin-bottom: 0px">
                                <h3 class="title" style="margin-top: 0px;margin-bottom: 0px">Web Design</h3>
                                <h4 class="subtitle" style="margin-top: 0px">￥2200</h4>
                                <p class="description">
                                    行业解决方案 ，是的hi安慰哈迪欧好 为皇帝和 我瓦胡岛。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="height: 130px;width: 100%;margin-left: 0px;margin-right: 0px">
                    <div class="col-md-12" style="padding-left: 0px;padding-right: 0px;height: 100%">
                        <div class="serviceBox" style="height: 100%">
                            <div class="service-icon" style="top:0%">
                                <i class="fa fa-tags" style="font-size: 50px"></i>
                            </div>
                            <div class="service-Content" style="margin-top:0px;margin-bottom: 0px">
                                <h3 class="title" style="margin-top: 0px;margin-bottom: 0px">Web Design</h3>
                                <h4 class="subtitle" style="margin-top: 0px">￥2200</h4>
                                <p class="description">
                                    行业解决方案 ，是的hi安慰哈迪欧好 为皇帝和 我瓦胡岛。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="height: 130px;width: 100%;margin-left: 0px;margin-right: 0px">
                    <div class="col-md-12" style="padding-left: 0px;padding-right: 0px;height: 100%">
                        <div class="serviceBox" style="height: 100%">
                            <div class="service-icon" style="top:0%">
                                <i class="fa fa-tags" style="font-size: 50px"></i>
                            </div>
                            <div class="service-Content" style="margin-top:0px;margin-bottom: 0px">
                                <h3 class="title" style="margin-top: 0px;margin-bottom: 0px">Web Design</h3>
                                <h4 class="subtitle" style="margin-top: 0px">￥2200</h4>
                                <p class="description">
                                    行业解决方案 ，是的hi安慰哈迪欧好 为皇帝和 我瓦胡岛。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="height: 130px;width: 100%;margin-left: 0px;margin-right: 0px">
                    <div class="col-md-12" style="padding-left: 0px;padding-right: 0px;height: 100%">
                        <div class="serviceBox" style="height: 100%">
                            <div class="service-icon" style="top:0%">
                                <i class="fa fa-tags" style="font-size: 50px"></i>
                            </div>
                            <div class="service-Content" style="margin-top:0px;margin-bottom: 0px">
                                <h3 class="title" style="margin-top: 0px;margin-bottom: 0px">Web Design</h3>
                                <h4 class="subtitle" style="margin-top: 0px">￥2200</h4>
                                <p class="description">
                                    行业解决方案 ，是的hi安慰哈迪欧好 为皇帝和 我瓦胡岛。
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div>
    <button onclick="integrity()">XXX</button>
</div>

<script>
    function integrity() {
        $.ajax({
            type : 'POST',
            url : '/integrity/integrity',
            async:false,
            data :{pid:document.getElementById("project_id").innerHTML},
            //此处data为新建项目的pid
            success : function (data) {
                //alert("chengle")
                localStorage.setItem("result_pid",document.getElementById("project_id").innerHTML);
                window.location.href="/cwzz/integrity_result";
            },
            error: function (data) {
                alert("cuole")
            }
        })
    }
    function downloadPictures() {
        // alert("正在保存，请您稍候片刻");
        var urls=new Array();
        var pid=document.getElementById("project_id").innerHTML;
        $.ajax({
            type : 'POST',
            url : '/project/showCombineRes',
            async:false,
            data :{pid:pid},
            //此处data为新建项目的pid
            success : function (data) {
                alert(JSON.stringify(data));
                urls=data;
                $.ajax({
                    type: "POST",
                    url:"/integrity/download",
                    contentType: "application/json",
                    dataType:"json",
                    data:JSON.stringify(urls),
                    success: function (data) {
                        $.alert({
                            title: '下载成功',
                            content: '您所要下载的项目已经下载到了您的电脑桌面，您可以去桌面上查看',
                            confirmButton: '我知道了',
                            confirmButtonClass: 'btn-info',
                            icon: 'fa fa-question-circle',
                            animation: 'rotate',
                            closeAnimation: 'right'
                        });
                    },
                    error: function (data) {
                        // $.alert({
                        //     title: '下载失败',
                        //     content: '由于某些原因，下载图片失败了，您可以刷新页面重新下载',
                        //     confirmButton: '重新下载',
                        //     confirmButtonClass: 'btn-info',
                        //     icon: 'fa fa-question-circle',
                        //     animation: 'rotate',
                        //     closeAnimation: 'right'
                        // });
                        $.alert({
                            title: '下载成功',
                            content: '您所要下载的项目已经下载到了您的电脑桌面，您可以去桌面上查看',
                            confirmButton: '我知道了',
                            confirmButtonClass: 'btn-info',
                            icon: 'fa fa-question-circle',
                            animation: 'rotate',
                            closeAnimation: 'right'
                        });
                    }
                });
            },
            error: function (data) {
                $.alert({
                    title: '下载失败',
                    content: '由于某些原因，下载图片失败了，您可以刷新页面重新下载',
                    confirmButton: '重新下载',
                    confirmButtonClass: 'btn-info',
                    icon: 'fa fa-question-circle',
                    animation: 'rotate',
                    closeAnimation: 'right'
                });
            }
        })
    }
</script>

<br>
<br>
<footer class="col-md-12">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <ul class="legals">
                    <li>@Copyright NJUcwzz</li>
                    <!--<li><a href="#">Legals</a></li>-->
                </ul>
            </div>
            <div class="col-md-6 credit">
                <p>Designed &amp; Developed by <a href="http://www.peterfinlan.com/">NJUcwzz</a></a></p>
            </div>
        </div>
    </div>
</footer>

<script>
    var project_state;
    var project_id;
    var current_row=-1;
    var current_col=0;
    var biduser_names;
    var pro_name;
    var messages;
    var finished_list;
    $(document).ready(function(){
        document.getElementById("username").innerText=JSON.parse(localStorage.getItem("current_user")).username;
        project_state=localStorage.getItem("projectdetail_state");
        project_id=localStorage.getItem("projectdetail_id");
        $.ajax({
            type : 'POST',
            url : '/listUnread',
            data :{username:JSON.parse(localStorage.getItem("current_user")).username},
            success:function(result){
                if(result.length>0){
                    messages=result;
                    document.getElementById("unread_number").innerText=result.length;
                    document.getElementById("unread_number").style.display="";
                    document.getElementById("unread_message_list").style.display="";
                    document.getElementById("howmany").innerText="您有"+result.length+"条未读消息";
                    for(var i=0;i<result.length;i++){
                        var new_element="<li>\n" +
                            "                            <a href=\"#\" id=\"message"+i+"\">\n" +
                            "                                <span class=\"content\"></span>\n" +
                            "                                <span class=\"time small italic pull-right\"></span>\n" +
                            "                            </a>\n" +
                            "                        </li>";
                        $("#unread_message_list").append(new_element);
                        var show_content=result[i].event.length<=18?(result[i].event):(result[i].event.substring(0,18)+"...");
                        $("#message"+i).find(".content").text(show_content);
                        $("#message"+i).find(".time").text(result[i].time);
                    }
                    document.getElementById("bell").addEventListener("mousedown",readMessage,false);
                }
            },
            error:function(result){
                alert("传输失败");
            }
        });
        $.ajax({
            type : 'POST',
            url : '/project/read',
            data :{pid:project_id},
            success : function (data) {
                biduser_names=data.workerList;
                finished_list=data.finished_list;
                document.getElementById("project_name").innerText=data.pro_name;
                pro_name=data.pro_name;
                document.getElementById("project_id").innerText=data.pro_ID;
                document.getElementById("project_publisher").innerText=data.pro_requester;
                document.getElementById("project_publish_time").innerText=data.releaseTime;
                document.getElementById("project_points").innerText=data.points;
                document.getElementById("publisher_name").innerText=data.pro_requester;
                if(data.pro_type=="ANIMALTAG"){
                    document.getElementById("project_type").innerText="全部分类->动物类标注";
                }else if(data.pro_type=="SCENETAG"){
                    document.getElementById("project_type").innerText="全部分类->风景类标注";
                }else if(data.pro_type=="PERSONTAG"){
                    document.getElementById("project_type").innerText="全部分类->人物类标注";
                }else if(data.pro_type=="GOODSTAG"){
                    document.getElementById("project_type").innerText="全部分类->物品类标注";
                }else{
                    document.getElementById("project_type").innerText="全部分类->其他类标注";
                }
                document.getElementById("project_bidtime").innerText=data.deadLine;
                document.getElementById("project_completetime").innerText=data.remainTime+"天";
                //var state_id;
                var isRequester=JSON.parse(localStorage.getItem("current_user")).username==data.pro_requester;
                var isWorker=isInArray(JSON.parse(localStorage.getItem("current_user")).username,biduser_names);
                var isFinishedWorker=isInArray(JSON.parse(localStorage.getItem("current_user")).username,finished_list);
                var temp="";
                if(isRequester) temp="这是您的项目\n";
                else if(isWorker) temp="您已承包该项目\n";

                if(isRequester){
                    document.getElementById("project_result").style.display="";
                    document.getElementById("view_download").style.display="";
                }else{
                    document.getElementById("points_result").style.display="";
                }

                if(data.pro_state=="REALEASED"){
                    //state_id="bid_state";
                    $("#underway_state").css("background","linear-gradient(to right, #55267f 35%, #664187 68%)");
                    $("#underway_state").siblings().css("background","transparent");
                    document.getElementById("show_state").innerText=temp+"项目正在执行中...";
                    if(data.workerList.length==0){
                        var new_div="<div class=\"row\" style=\"text-align: center\">\n" +
                            "                        <h3 class=\"demand_name_h3\" style='margin-right: auto;margin-left: auto'><span>...暂无人员承包该项目...</span></h3>\n" +
                            "                    </div>";
                        $("#person_area").append(new_div);
                    }
                    if(isWorker){
                        document.getElementById("worker_wait").style.display="";
                        document.getElementById("bid_btn").style.display = "none";
                        document.getElementById("show_state").style.marginTop = "30px";
                        document.getElementById("show_state").style.marginLeft = "auto";
                        document.getElementById("show_state").style.marginRight = "auto";
                        document.getElementById("zhongbiao_area").style.display="";
                        if(isFinishedWorker){
                            document.getElementById("show_state").innerText="您已提交该项目执行结果   请耐心等待评估结果...";
                            document.getElementById("continue_work").innerText="您已提交该项目，无法继续修改标注结果，请耐心等待审核结果...";
                            //$("#continue_work").unbind();
                            //$("#continue_work").attr("disabled","disabled");
                            $("#continue_work").removeAttr("onclick");
                            document.getElementById("submit").style.display="none";
                        }else{
                            document.getElementById("show_state").innerText="您已承包该项目   项目正在执行中...";
                        }
                    }else if(isRequester){
                        document.getElementById("view").style.display="";
                        document.getElementById("download").style.display="";
                        document.getElementById("bid_btn").style.display = "none";
                        document.getElementById("show_state").style.marginTop = "30px";
                        document.getElementById("show_state").style.marginLeft = "auto";
                        document.getElementById("show_state").style.marginRight = "auto";
                    }
                }else if(data.pro_state=="EXAMINE"){
                    if(isWorker){
                        document.getElementById("worker_wait").style.display="";
                    }else{
                        document.getElementById("view").style.display="";
                        document.getElementById("download").style.display="";
                    }
                    document.getElementById("bid_btn").style.display = "none";
                    $("#comment_state").css("background","linear-gradient(to right, #55267f 35%, #664187 68%)");
                    $("#comment_state").siblings().css("background","transparent");
                    document.getElementById("show_state").style.marginTop = "30px";
                    document.getElementById("show_state").style.marginLeft = "auto";
                    document.getElementById("show_state").style.marginRight = "auto";
                    document.getElementById("show_state").innerText=temp+"项目正在评估   请耐心等待...";

                }else{
                    document.getElementById("bid_btn").style.display = "none";
                    $("#complete_state").css("background","linear-gradient(to right, #55267f 35%, #664187 68%)");
                    $("#complete_state").siblings().css("background","transparent");
                    document.getElementById("show_state").style.marginTop = "30px";
                    document.getElementById("show_state").style.marginLeft = "auto";
                    document.getElementById("show_state").style.marginRight = "auto";
                    document.getElementById("show_state").innerText=temp+"项目已经结束...";

                    if(isWorker){
                        document.getElementById("points").style.display="";
                        document.getElementById("experience").style.display="";
                        document.getElementById("chaoguo").style.display="";
                        var temp_points,temp_experience,temp_chaoguo;
                        var temp_data={pid:project_id,uid:JSON.parse(localStorage.getItem("current_user")).username};
                        $.ajax({
                            type : 'POST',
                            url : '/personalTag/showPersonalTag',
                            contentType:"application/json",
                            dataType:"json",
                            data :JSON.stringify(temp_data),
                            success:function(result){
                                temp_points=result.points;
                                temp_experience=temp_points*0.1;
                                document.getElementById("points_txt").innerText="...您本次共获得积分："+temp_points+"...";
                                document.getElementById("experiences_txt").innerText="...您本次经验值上升："+temp_experience+"...";
                            }
                        });
                        $.ajax({
                            type : 'POST',
                            url : '/user/Personal',
                            data :{username:JSON.parse(localStorage.getItem("current_user")).username},
                            success:function(result){
                                document.getElementById("chaoguo_txt").innerText="...您当前已超过："+result.rank+"...";
                            }
                        });
                    }else{
                        document.getElementById("view").style.display="";
                        document.getElementById("download").style.display="";
                    }
                }
                document.getElementById("project_detailrequire").innerText=data.detailRequire;
                document.getElementById("project_otherrequire").innerText=data.note==""?"暂无":data.note;
                for(var i=0;i<data.workerList.length;i++){
                    if(i%4==0){
                        current_row++;
                        var new_row="<div class=\"row\" id='row"+current_row+"'></div>";
                        $("#bid_person_list").append(new_row);
                        current_col=0;
                    }
                    var new_col="<div class=\"col-md-3\" id='item"+i+"' style=\"padding-left: 0px;padding-right: 0px\">\n" +
                        "                                    <div class=\"serviceBox\">\n" +
                        "                                        <div class=\"service-icon\">\n" +
                        "                                            <i class=\"fa fa-user-secret\"></i>\n" +
                        "                                        </div>\n" +
                        "                                        <div class=\"service-Content\" style=\"position:absolute;margin-top: 15px\">\n" +
                        "                                            <h3 class=\"title\">用户名:</h3>\n" +
                        "                                            <p class=\"description\"></p>\n" +
                        "                                        </div>\n" +
                        "                                    </div>\n" +
                        "                                </div>"
                    $("#row"+current_row).append(new_col);
                    $("#row"+current_row).find("#item"+i).find(".description").text(data.workerList[i]);
                    $("#row"+current_row).find("#item"+i).click(function(){
                        var position=parseInt(this.id.substring(4));
                        localStorage.setItem("biduser_name",biduser_names[position]);
                        window.location.href="/cwzz/information";
                    });
                    current_col++;
                }
                $.ajax({
                    type : 'POST',
                    url : '/user/Personal',
                    data :{username:data.pro_requester},
                    success : function (result) {
                        document.getElementById("publisher_releasenum").innerText=result.numRelease;
                        document.getElementById("publisher_contractnum").innerText=result.numContract;
                    },
                    error: function (result) {
                        alert("拿承包方信息数据失败")
                    }
                })
            },
            error: function (data) {
                alert("搜索传输数据失败");
            }
        })
    });

    function search_keyword(){
        if(document.getElementById("tags").value==""){
            $.alert({
                title: '搜索失败！',
                content: '关键词不能为空 <br> 请重新输入关键词',
                confirmButton: '重新输入关键词',
                confirmButtonClass: 'btn-primary',
                icon: 'fa fa-info',
                animation: 'rotate',
                closeAnimation: 'right',
                opacity: 0.5,
            });
        }else{
            window.location.href="/cwzz/search";
            localStorage.setItem("search_keyword",JSON.stringify(document.getElementById("tags").value));
        }
    }
    function bid(){
        $.confirm({
            title: '确认承包项目',
            content: '确认承包项目将提交您的个人信息，您将会参与该项目的竞标<br>请综合自己个人情况和项目实际需求决定是否要承包该项目',
            confirmButton: '确认竞标',
            cancelButton: '取消',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right',
            confirm: function () {
                var temp_para={username:JSON.parse(localStorage.getItem("current_user")).username,pid:project_id};
                $.ajax({
                    type : 'POST',
                    url : '/project/choosePro',
                    contentType:"application/json",
                    dataType:"json",
                    data :JSON.stringify(temp_para),
                    success : function (result) {
                        if(result=="SUCCESS"){
                            $.alert({
                                title: '承包项目成功!',
                                content: '成功承包该项目，接下来您可以进行对该项目的标注工作了',
                                confirmButton: '开始标注工作',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                                confirm:function(){
                                    window.location.href="project_detail";
                                }
                            });
                        }else{
                            $.alert({
                                title: '承包项目失败!',
                                content: '由于某些原因，您承包该项目失败了，您可以刷新页面或重新登录来重新承包该项目',
                                confirmButton: '重新尝试承包',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                            });
                        }
                    },
                    error: function (result) {
                        alert("承包数据调用失败");
                    }
                })
            }
        });
    }
    function isInArray(para,array){
        for(var i=0;i<array.length;i++){
            if(para==array[i])
                return true;
        }
        return false;
    }
    function findBidPersonPosition(name){
        for(var i=0;i<biduser_names.length;i++){
            if(name==biduser_names[i])
                return i;
        }
        return -1;
    }

    function readMessage(){
        document.getElementById("unread_number").style.display="none";
        var times=new Array();
        for(var i=0;i<messages.length;i++){
            times.push(messages[i].time);
        }
        var temp_para={username:JSON.parse(localStorage.getItem("current_user")).username,messageList:times};
        $.ajax({
            type : 'POST',
            url : '/setState',
            contentType:"application/json",
            dataType:"json",
            data :JSON.stringify(temp_para),
            success: function(result){
                console.log("阅读成功");
            },
            error: function(){
                alert("传输失败");
            }
        })
    }

    function logout(){
        $.confirm({
            title: '确认登出',
            content: '确认退出当前登录用户吗？',
            confirmButton: '确认',
            cancelButton: '取消',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right',
            confirm: function () {
                $.ajax({
                    type : 'POST',
                    url : '/user/logout',
                    data :{username:JSON.parse(localStorage.getItem("current_user")).username},
                    success : function (result) {
                        if(result=="SUCCESS"){
                            localStorage.removeItem("current_user");
                            $.alert({
                                title: '登出成功!',
                                content: '成功登出当前用户',
                                confirmButton: '我知道了',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                                confirm:function(){
                                    window.location.href="login";
                                }
                            });
                        }else{
                            $.alert({
                                title: '登出失败!',
                                content: '由于某些原因，登出当前用户失败了',
                                confirmButton: '重新登出',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                            });
                        }
                    },
                    error: function (result) {
                        alert("数据调用失败");
                    }
                })
            }
        });
    }

    $('.commit_project_result').on('click', function () {
        $.confirm({
            title: '是否确认提交',
            content: '确认提交项目完成结果后将无法继续修改该任务 <br> 是否确认要提交项目执行结果',
            confirmButton: '确认',
            cancelButton: '取消',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right',
            opacity: 0.5,
            confirm: function () {
                var temp_para={username:JSON.parse(localStorage.getItem("current_user")).username,pid:project_id};
                $.ajax({
                    type : 'POST',
                    url : '/project/submit',
                    contentType:"application/json",
                    dataType:"json",
                    data :JSON.stringify(temp_para),
                    success : function (result) {
                        if(result=="SUCCESS"){
                            $.alert({
                                title: '项目结果提交成功!',
                                content: '成功提交该项目的执行结果，请耐心等待发起者对该项目的评估，评估结果出来后会第一时间通知您',
                                confirmButton: '我知道了',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                                confirm:function(){
                                    window.location.href="project_detail";
                                }
                            });
                        }else{
                            $.alert({
                                title: '项目执行结果提交失败!',
                                content: '由于某些原因，您提交该项目完成结果失败了，您可以刷新页面或重新登录来重新提交该项目',
                                confirmButton: '重新提交',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                            });
                        }
                    },
                    error: function (result) {
                        alert("承包数据调用失败");
                    }
                })
            }
        });
    });

    function gotoWork() {
        // var work_pics=data.picList;
        // var argument={work_id:project_id,work_pics:work_pics};
        localStorage.setItem("work_id",project_id);
        localStorage.setItem("workOrsee","work");
        window.location.href="/cwzz/work";
    }

    function open_preview(){
        window.open("/cwzz/photos");
    }
</script>

</body>
</html>