<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" integrity="sha384-DmABxgPhJN5jlTwituIyzIUk6oqyzf3+XuP7q3VfcWA2unxgim7OSSZKKf0KSsnh" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" type="text/css" media="all">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="/css/queries.css" rel="stylesheet">
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/font-awesome.css" rel="stylesheet">
    <link href="/css/carousel.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/default.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/css.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/pop-up-box" type="text/css" media="all">
    <link rel="stylesheet" type='text/css' href="/css/log.css">
    <link rel="stylesheet" type="text/css" href="/css/head.css">
    <link rel="stylesheet" type="text/css" href="/css/out-style.css">
    <link rel="stylesheet" type="text/css" href="/css/style-responsive.css">
    <link rel="stylesheet" type="text/css" href="/css/line-icons.css">
    <link href="/css/elegant-icons-style.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" integrity="sha384-DmABxgPhJN5jlTwituIyzIUk6oqyzf3+XuP7q3VfcWA2unxgim7OSSZKKf0KSsnh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/jquery-confirm.css" />

    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="/js/modernizr.min.js"></script>
    <script src="/js/jquery.js"></script>
    <script src="/js/jquery.easing.1.3.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/classie.js"></script>
    <script type="text/javascript" src="/js/jquery-confirm.js"></script>

    <!--upload-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/upload/upload.css">
    <style type="text/css">
        h3 {
            margin-bottom: 1rem;
            border-left: 5px solid #446cb3;
            padding-left: 0.5rem;
            color: black;
            font-size: 22px;
        }

        #time input{
            max-width: 400px;
            outline: none;
            border: 1px solid #ddd;
            border-radius: 3px;
            color: rgba(0, 0, 0, 0.87);
            padding: 0 0 0 11px;
            height: 40px;
            width: 100%;
            margin-right: 0;
            margin-bottom: 0.5rem;
        }

        .container{padding: 1.5em 0;}
        .custom-input {
            position: relative;
            padding-top: 20px;
            margin-bottom: 10px;
        }

        .custom-input input {
            padding-left: 15px;
        }

        .custom-input label {
            cursor: text;
            margin: 0;
            padding: 0;
            left: 15px;
            top: 27px;
            position: absolute;
            font-size: 14px;
            color: #ccc;
            font-weight: normal;
            transition: all .3s ease;
        }

        .custom-input label.active {
            top: 0;
            left: 0;
            font-size: 12px;
        }

        .custom-input label.active.focusIn {
            color: #66afe9;
        }

        .submitPart{
            background-color: #FFFFFF;
            border-color: #66afe9;
            border: 5px;
            border-radius: 15px;
            -webkit-text-fill-color: #66afe9;
            font-size: 30px;

        }
    </style>
    <!--[if IE]>
    <script src="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>
    <![endif]-->


</head>
<body>
<div class="navbar navbar-fixed-top skrollable skrollable-between" role="navigation"
     style="line-height:60px; height:80px; background-color:rgba(255, 255, 255, 0.8);">
    <div class="container">
        <div class="navbar-header" style="margin-top: 22px">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="fa fa-bars color-white"></span>
            </button>
            <p style="font-size:2em;margin: 0.67em 0;color: #353535">众包标注平台<a class="navbar-brand skrollable skrollable-between" href="<%=basePath%>"
                                                                              style="display:none;margin-top:5px;"></a>
            </p>
        </div>

        <ul class="menu nav navbar-nav skrollable skrollable-between nnav"
            style="margin-top:22px;display:inline;left: 48%;position: absolute;" >
            <li><a href="/cwzz/introduce">首页</a>
                <ul class="submenu">
                    <li><a href="/introduce">网站介绍</a></li>
                    <!--<li><a href="<%=basePath%>/market/market">大盘概览</a></li>-->
                </ul>
            </li>
            <li><a href="/cwzz/home">项目</a>
                <ul class="submenu">
                    <li><a href="/cwzz/home">项目大厅</a></li>
                    <li><a href="/cwzz/upload">发布项目</a></li>
                </ul>
            </li>
            <li><a href="/cwzz/personal_center">个人</a>
                <ul class="submenu">
                    <li><a href="/cwzz/personal_center">个人信息</a></li>
                    <li><a href="/cwzz/personal_center">任务详情</a></li>
                </ul>
            </li>
            <li><a href="<%=basePath%>/help">帮助</a>
                <ul class="submenu">
                    <li><a href="<%=basePath%>/help">详情咨询</a></li>
                    <li><a href="<%=basePath%>/aboutus">关于我们</a></li>
                </ul>
            </li>
            <!--<li>-->
            <!--<a href="<%=basePath%>/user/signin">登录</a>-->
            <!--<ul class="submenu">-->
            <!--<li><a href="<%=basePath%>/user/signup">注册</a></li>-->
            <!--</ul>-->
            <!--</li>-->
        </ul>

        <div class="top-nav notification-row" style="margin-left: 0px;margin-top: 0px;display: inline-block;position: absolute;left:85%">
            <!-- notificatoin dropdown start-->
            <ul class="nav pull-right top-menu">
                <!-- alert notification start-->
                <li id="alert_notificatoin_bar" class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#" id="bell">

                        <i class="icon-bell-l"></i>
                        <span class="badge bg-important" id="unread_number" style="display: none"></span>
                    </a>
                    <ul class="dropdown-menu extended notification" id="unread_message_list" style="display: none;">
                        <div class="notify-arrow notify-arrow-blue"></div>
                        <li>
                            <p class="blue" id="howmany"></p>
                        </li>
                    </ul>
                </li>
                <!-- alert notification end-->
                <!-- user login dropdown start-->
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="profile-ava">
                                <i class="fas fa-user"></i>
                            </span>
                        <span class="username" id="username"></span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <li class="eborder-top">
                            <a href="#"><i class="fas fa-home"></i> 个人中心</a>
                        </li>
                        <li>
                            <a onclick="logout()"><i class="fas fa-sign-out-alt"></i> 登出</a>
                        </li>
                        <li>
                            <a onclick="logout()"><i class="fas fa-exchange-alt"></i> 切换账号</a>
                        </li>
                    </ul>
                </li>
                <!-- user login dropdown end -->
            </ul>
            <!-- notificatoin dropdown end-->
        </div>

    </div>
</div>

<br>
<br>

<!--<div>-->
    <!--<div class="headfooter" >-->
        <!--<div class="headfootercontent">-->
            <!--<h1 class="hfcb"><a href="">众包标注平台</a></h1>-->

            <!--<div class="top_m_m">-->
                <!--<div class="free_requirment">-->
                    <!--<a href="/cwzz/upload" target="_blank" class="free_a" onclick="newProject()"><i class="fa fa-cloud-upload"></i>免费发布需求</a>-->
                <!--</div>-->
                <!--<div class="top_m_m_t">-->
                    <!--<a style="float:left;" class="navzise" href="javascript:void(0)" onClick="Submit(0)" id="all">全部</a>-->
                    <!--<a style="float:left;" class="heise" href="javascript:void(0)" id="xq" onClick="Submit(4)">项目</a>-->
                    <!--<a style="float:left;" class="heise" href="javascript:void(0)" onClick="Submit(2)" id="pr">承包方</a>-->
                    <!--<a style="float:left;" class="heise" href="javascript:void(0)" onClick="Submit(3)" id="dp">发包方</a>-->

                    <!--&lt;!&ndash; <a class="heise" href="javascript:void(0)" onClick="Submit(2)" id="fw">服务</a> &ndash;&gt;-->
                <!--</div>-->
                <!--<div class="top_m_m_b">-->
                    <!--<div id="form_search">-->
                        <!--<input type="hidden" value="0" id="flag" name="flag">-->
                        <!--<input type="text" value="" class="formcontrol" name="keyword" id="tags" placeholder="请输入关键字">-->
                        <!--<input type="submit" value="" class="formsousuo" name="" id="search_btn" onclick="search_keyword()">-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div></div>-->
<!--</div>-->
<!--<script>-->
    <!--function Submit(type) {-->
        <!--if (type == "0") {-->
            <!--// $("#form_search").attr("action", "http://www.rdplat.com/shopDetails");-->
            <!--$("#flag").val(type);-->
            <!--//$("#form_search").submit();-->
            <!--// $("#fw").removeClass('heise');-->
            <!--// $("#fw").addClass('navzise');-->

            <!--$("#xq").removeClass('navzise');-->
            <!--$("#xq").addClass('heise');-->

            <!--$("#pr").removeClass('navzise');-->
            <!--$("#pr").addClass('heise');-->

            <!--$("#dp").removeClass('navzise');-->
            <!--$("#dp").addClass('heise');-->

            <!--$("#all").removeClass('heise');-->
            <!--$("#all").addClass('navzise');-->
            <!--$(".formcontrol").removeAttr('placeholder');-->
            <!--$(".formcontrol").attr('placeholder','请输入关键字');-->

        <!--}-->
        <!--if (type == "2") {-->
            <!--// $("#form_search").attr("action", "http://www.rdplat.com/shopDetail");-->
            <!--$("#flag").val(type);-->
            <!--//$("#form_search").submit();-->
            <!--$("#pr").removeClass('heise');-->
            <!--$("#pr").addClass('navzise');-->

            <!--$("#xq").removeClass('navzise');-->
            <!--$("#xq").addClass('heise');-->

            <!--// $("#fw").removeClass('navzise');-->
            <!--// $("#fw").addClass('heise');-->

            <!--$("#dp").removeClass('navzise');-->
            <!--$("#dp").addClass('heise');-->

            <!--$("#all").removeClass('navzise');-->
            <!--$("#all").addClass('heise');-->
            <!--$(".formcontrol").removeAttr('placeholder');-->
            <!--$(".formcontrol").attr('placeholder','请输入承包方关键字');-->

        <!--}-->
        <!--if (type == "3") {-->
            <!--// $("#form_search").attr("action", "http://www.rdplat.com/shop");-->
            <!--$("#flag").val(type);-->
            <!--//$("#form_search").submit();-->
            <!--$("#dp").removeClass('heise');-->
            <!--$("#dp").addClass('navzise');-->

            <!--$("#xq").removeClass('navzise');-->
            <!--$("#xq").addClass('heise');-->

            <!--$("#pr").removeClass('navzise');-->
            <!--$("#pr").addClass('heise');-->

            <!--// $("#fw").removeClass('navzise');-->
            <!--// $("#fw").addClass('heise');-->

            <!--$("#all").removeClass('navzise');-->
            <!--$("#all").addClass('heise');-->
            <!--$(".formcontrol").removeAttr('placeholder');-->
            <!--$(".formcontrol").attr('placeholder','请输入发包方关键字');-->
        <!--}-->
        <!--if (type == "4") {-->
            <!--// $("#form_search").attr("action", "http://www.rdplat.com/leaderTask");-->
            <!--$("#flag").val(type);-->
            <!--//$("#form_search").submit();-->
            <!--$("#xq").removeClass('heise');-->
            <!--$("#xq").addClass('navzise');-->
            <!--// $("#fw").removeClass('navzise');-->
            <!--// $("#fw").addClass('heise');-->
            <!--$("#pr").removeClass('navzise');-->
            <!--$("#pr").addClass('heise');-->
            <!--$("#dp").removeClass('navzise');-->
            <!--$("#dp").addClass('heise');-->
            <!--$("#all").removeClass('navzise');-->
            <!--$("#all").addClass('heise');-->
            <!--$(".formcontrol").removeAttr('placeholder');-->
            <!--$(".formcontrol").attr('placeholder','请输入项目方关键字');-->
        <!--}-->
    <!--}-->
<!--</script>-->

<script>

    var messages;

    $(document).ready(function(){
        document.getElementById("username").innerText=JSON.parse(localStorage.getItem("current_user")).username;
        $.ajax({
            type : 'POST',
            url : '/listUnread',
            data :{username:JSON.parse(localStorage.getItem("current_user")).username},
            success:function(result){
                if(result.length>0){
                    messages=result;
                    document.getElementById("unread_number").innerText=result.length;
                    document.getElementById("unread_number").style.display="";
                    document.getElementById("unread_message_list").style.display="";
                    document.getElementById("howmany").innerText="您有"+result.length+"条未读消息";
                    for(var i=0;i<result.length;i++){
                        var new_element="<li>\n" +
                            "                            <a href=\"#\" id=\"message"+i+"\">\n" +
                            "                                <span class=\"content\"></span>\n" +
                            "                                <span class=\"time small italic pull-right\"></span>\n" +
                            "                            </a>\n" +
                            "                        </li>";
                        $("#unread_message_list").append(new_element);
                        var show_content=result[i].event.length<=18?(result[i].event):(result[i].event.substring(0,18)+"...");
                        $("#message"+i).find(".content").text(show_content);
                        $("#message"+i).find(".time").text(result[i].time);
                    }
                    document.getElementById("bell").addEventListener("mousedown",readMessage,false);
                }
            },
            error:function(result){
                alert("传输失败");
            }
        });
    })
    function readMessage(){
        document.getElementById("unread_number").style.display="none";
        var times=new Array();
        for(var i=0;i<messages.length;i++){
            times.push(messages[i].time);
        }
        var temp_para={username:JSON.parse(localStorage.getItem("current_user")).username,messageList:times};
        $.ajax({
            type : 'POST',
            url : '/setState',
            contentType:"application/json",
            dataType:"json",
            data :JSON.stringify(temp_para),
            success: function(result){
                console.log("阅读成功");
            },
            error: function(){
                alert("传输失败");
            }
        })
    }

    function logout(){
        $.confirm({
            title: '确认登出',
            content: '确认退出当前登录用户吗？',
            confirmButton: '确认',
            cancelButton: '取消',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right',
            confirm: function () {
                $.ajax({
                    type : 'POST',
                    url : '/user/logout',
                    data :{username:JSON.parse(localStorage.getItem("current_user")).username},
                    success : function (result) {
                        if(result=="SUCCESS"){
                            localStorage.removeItem("current_user");
                            $.alert({
                                title: '登出成功!',
                                content: '成功登出当前用户',
                                confirmButton: '我知道了',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                                confirm:function(){
                                    window.location.href="login";
                                }
                            });
                        }else{
                            $.alert({
                                title: '登出失败!',
                                content: '由于某些原因，登出当前用户失败了',
                                confirmButton: '重新登出',
                                confirmButtonClass: 'btn-primary',
                                icon: 'fa fa-info',
                                animation: 'zoom',
                            });
                        }
                    },
                    error: function (result) {
                        alert("数据调用失败");
                    }
                })
            }
        });
    }

    function search_keyword(){
        if(document.getElementById("tags").value==""){
            $.alert({
                title: '搜索失败！',
                content: '关键词不能为空 <br> 请重新输入关键词',
                confirmButton: '重新输入关键词',
                confirmButtonClass: 'btn-primary',
                icon: 'fa fa-info',
                animation: 'rotate',
                closeAnimation: 'right',
                opacity: 0.5,
            });
        }else{
            //window.location.href="/cwzz/search";
            window.open("/cwzz/search")
            localStorage.setItem("search_keyword",JSON.stringify(document.getElementById("tags").value));
        }
    }
</script>
</body>
</html>