<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>众包标注系统工作页面</title>
    <link href="/css/MainWorkingWeb.css" type="text/css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" integrity="sha384-DmABxgPhJN5jlTwituIyzIUk6oqyzf3+XuP7q3VfcWA2unxgim7OSSZKKf0KSsnh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/css/jquery-confirm.css" />
    <link rel="stylesheet" href="/css/edit_demo.css">
    <link rel="stylesheet" href="/css/imageLabel.css">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/jquery.jspanel.css" type="text/css">

    <script type="text/javascript" src="/jquery-ui-1.11.0.custom/external/jquery/jquery-1.11.0.js"></script>
    <link rel="stylesheet" href="/jquery-ui-1.11.0.custom/jquery-ui.css" />
    <link rel="stylesheet" href="/jquery-ui-1.11.0.custom/jquery-ui.structure.css" />
    <link rel="stylesheet" href="/colorpicker-master/jquery.colorpicker.css" />
    <link rel="stylesheet" href="/jquery-ui-1.11.0.custom/jquery-ui.theme.css" />
    <script type="text/javascript" src="/jquery-ui-1.11.0.custom/jquery-ui.js"></script>
    <script type="text/javascript" src="/colorpicker-master/jquery.colorpicker.js"></script>
    <script type="text/javascript" src="/colorpicker-master/parts/jquery.ui.colorpicker-rgbslider.js"></script>
    <script type="text/javascript" src="/js/jquery-ui-complete.min.js"></script>
    <script type="text/javascript" src="/js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="/js/jquery.jspanel.min.js"></script>
    <!--<script src="/js/bootstrap.min.js"></script>-->

    <script src="/js/MainWorkingWeb.js"></script>
    <script type="text/javascript" src="/js/jquery-confirm.js"></script>
    <!--<script src="/js/bootstrap.min.js"></script>-->

    <style>
        fieldset{height:66px;padding:4.9px 10.5px 8.68px 10.5px;margin:0 2px 0 2px;border:2px solid silver;border-radius:8px;font-size: 14px;float: left}
        legend{font-size: 14px;padding:0 2px 0 2px;border:0;width:auto;margin-bottom:0px;height: 18.48px}
        .demand_name_h3{
            padding:40px 0 30px 0;
            margin:0;
            font-size:18px;
            color:#55267f;
        }
        .input-area {
            border:2px solid #ddd;
            border-radius:0;
            color:#999;
            display:block;
            /*font:400 1em/1 "Open Sans",sans-serif;*/
            margin:0 0 0 0;
            padding:1em 1.25em;
            -webkit-transition:border-color 300ms,color 300ms;
            transition:border-color 300ms,color 300ms;
            -webkit-appearance:none;
        }
        .input-area:focus {
            border-color:#333;
            color:#333;
            outline:0
        }
        .input-area {
            margin:0;
            min-height:7.5em;
            line-height:1.5;
            overflow:auto;
            resize:vertical
        }
        .arrow {
            border-top:9px solid #ddd;
            border-right:9px solid #ddd;
            border-bottom:9px inset transparent;
            border-left:9px inset transparent;
            display:block;
            position:relative;
            right:0%;
            top:0%;
            -webkit-transition:border-color 300ms;
            transition:border-color 300ms;
            width: 0px;
        }
        .input-area:focus+.arrow {
            border-top-color:#333;
            border-right-color:#333
        }
        .jsPanel-btn-close{
            display: none;
        }
        .jsPanel-btn-max{
            display: none;
        }
        .jsPanel-btn-min{
            display: none;
        }
        .jsPanel-btn-norm {
            display: none;
        }
        .jsPanel-btn-small{
            display: none;
        }
        .jsPanel-btn-smallrev{
            display: none;
        }
    </style>

</head>

<body style="padding: 0px;margin: 0px; background-color: #FAFAFA;overflow: hidden" onbeforeunload="close()">

<!--菜单部分-->
<div id="menu" style="background-color: #323232;width:100%;height: 7%;padding-left: 0px">
    <span style="font-size: 20px;color:#ffffff;position: relative;top:25%;margin-left: 1%"><i class="fas fa-reply-all" title="返回项目详细信息页面" style="cursor: pointer" onclick="back()"></i></span>
    <span id="name" style="font-size: 20px;color:#ffffff;position: relative;top:25%;margin-left: 2%"></span>
    <span id="alert" style="font-size: 20px;color:#ffffff;position: relative;top:25%;margin-left: 75%"><i class="fas fa-exclamation-triangle" title="查看提示信息" style="cursor: pointer" onclick="out_alert()"></i></span>
    <span id="submit_next" style="font-size: 20px;color:#ffffff;position: relative;top:25%;margin-left: 2%"><i class="fas fa-upload" title="更换下一批图片" style="cursor: pointer" onclick="come_next()"></i></span>
</div>


<!--左边选择框-->
<div class="custom-scroll custom-scroll-2" id="left" style="background-color: #FAFAFA;float: left">
</div>

<!--中间操作框-->
<div id="middle" style="background-color: #FFFFFF;float: left;position: absolute">
    <div class="outer-box" style="width: 100%;height: 70px;">
    <div style="font-size:14px;width: 941px;height: 70px;margin-left: auto;margin-right: auto">
        <fieldset style="float:left;width: 316px;">
            <legend>工具</legend>
            <div id="toolsOptions">
                <input type="radio" id="tools_rectangle" name="toolsOption" onclick="clickRectangle()"><label for="tools_rectangle">矩形</label>&nbsp;
                <input type="radio" id="tools_pencil" name="toolsOption" checked="checked" onclick="clickPen()"><label for="tools_pencil">铅笔</label> &nbsp;
                <!--<button id="tools_undo">撤销</button>&nbsp;-->
                <!--<button id="tools_redo">重做</button>&nbsp;-->
                <input type="radio" id="tools_trash" name="toolsOption" onclick="clickEmpty()"><label 	for="tools_trash">清空</label>
            </div>
        </fieldset>
        <fieldset style="float:left;width:250px;">
            <legend>线条设置</legend>
            <span style="float: left">颜色:&nbsp;&nbsp;<input id="colorpicker-popup" type="text"  value="000000" style="width: 72px;display:none;margin-top: 6px">&nbsp;&nbsp;</span>
            <span style="float: left;margin-top: 6px">粗细: </span>&nbsp;&nbsp;
            <select id="penWidth" style="width: 40px">
                <option value="1" selected>1px</option>
                <option value="2">2px</option>
                <option value="4">4px</option>
                <option value="6">6px</option>
                <option value="8">8px</option>
                <option value="12">12px</option>
                <option value="14">14px</option>
                <option value="16">16px</option>
                <option value="18">18px</option>
            </select>
        </fieldset>
        <fieldset style="float:left;width:305px;">
            <legend>字体设置</legend>
            <span>
                <span style="float: left">颜色:&nbsp;&nbsp;<input id="colorpicker-font" type="text"  value="000000" style="width: 72px;display:none;margin-top: 6px">&nbsp;&nbsp;</span>
				<span style="font-weight:bold;float: left"><input type="checkbox" id="boldOption" name="fontOption"><label for="boldOption" id="ifBold">加粗</label></span>&nbsp;&nbsp;
				<span style="font-style: italic;float: left;display: none"><input type="checkbox" id="italicOption" name="italicOption"><label for="italicOption">I</label></span>
				<span style="float: left;margin-top: 6px;">大小:</span>
	            <select id="fontSize" style="width: 27px;margin-top: 0px;height: 34px">
				    <option value="8px" selected>8px</option>
				    <option value="10px">10px</option>
				    <option value="12px">12px</option>
				    <option value="14px">14px</option>
			    	<option value="16px">16px</option>
				    <option value="18px">18px</option>
				    <option value="20px">20px</option>
				    <option value="22px">22px</option>
				    <option value="24px">24px</option>
				    <option value="26px">26px</option>
				    <option value="28px">28px</option>
				    <option value="30px">30px</option>
				    <option value="32px">32px</option>
				    <option value="34px">34px</option>
				     <option value="36px">36px</option>
			    </select>
			</span>
        </fieldset>
    </div>
    </div>
    <div id="workspace" style="background: url('https://i.imgur.com/3O393wo.jpg');width: 100%;height: 100%">
        <!--<img id=under_pic class="workpic" style="position:absolute;z-index:0">-->
        <div class="imageLabel-box" id="image-box" style="background: transparent">
            <div class="imageLabel">
                <div class="imageLabel-img-boxs">
                    <span class="imageLabel-img-body">
                        <div class="imageLabel-loading-body">
                            <div class="imageLabel-loading"></div>
                        </div>
                        <div class="imageLabel-jisuan" style="position: relative;overflow:hidden;">
                            <img alt="" style="position: absolute;with:100%;height:100%;" class="imageLabel-img" id="tag-img">
                            <div class="imageLabel-content" id="work_area"></div>
                        </div>
                        <canvas id="canvas" style="display: none;z-index: 98"></canvas>
                        <canvas id="canvas_bak" style="display: none;z-index: 99;"></canvas>
                        <canvas id="jietu_canvas" style="z-index: 99;display: none"></canvas>
                    </span>
                    <ul class="imageLabel-drap-menu">
                        <div style="overflow: hidden;">
                            <div style="cursor: pointer;" class="imageLabel-delete btns">删除</div>
                            <div style="cursor: pointer;" class="imageLabel-edit btns">编辑</div>
                        </div>
                    </ul>
                </div>
                <div class="imageLabel-buttons" style="display: none">
                    <div class="imageLabel-btn imageLabel-closes">关闭</div>
                    <div class="imageLabel-btn">确定</div>
                </div>
                <div class="imageLabel-input" style="background-color:rgba(255,255,255,0.3);">
                    <div class="imageLabel-input-box" style="width:250px;">
                        <div style="background-color: #333;">
                            <div style="color:#fff;overflow:hidden;line-height: 40px;">
                                <span style="float: left;margin-left:20px;">编辑内容</span>
                                <span class="imageLabel-input-close" style="float:right;margin-right:20px;cursor: pointer;">X</span>
                            </div>
                        </div>
                        <div style="background: #fff;padding:20px;">
                            <input type="text" value="" max="10" style="width:100%;padding:5px;">
                            <div style="margin-top:20px;overflow:hidden;">
                                <div class="imageLabel-input-close imageLabel-btn" style="float: left;width:90px;background-color: #959595;">取消</div>
                                <div class="imageLabel-input-ok imageLabel-btn" style="float: right;width:90px;">确定</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <img id="test1" src="" style="display: none">
    <img id="test2" src="" style="display: none">
</div>


<script>
    initialize();
    if(localStorage.getItem("workOrsee")=="see"){
        $(".input_readonly").attr("readonly","readonly");
        document.getElementById("tools").innerHTML="";
    }
    $(document).ready(function(){
        $("#menu").css("padding-left","0px");
        //3. 工具条
        $("#tools_pencil").button({
            icons:{
                primary:"ui-icon-pencil"
            }
        });

        $("#tools_eraser").button({
            icons:{
                primary:"ui-icon-bullet"
            }
        });
        $("#tools_trash").button({
            icons:{
                primary:"ui-icon-trash"
            }
        });

        $("#tools_save").button({
            icons:{
                primary:"ui-icon-disk"
            }
        });


        $("#tools_undo").button({
            icons:{
                primary:"ui-icon-arrowreturnthick-1-w"
            }
        });

        $("#tools_redo").button({
            icons:{
                primary:"ui-icon-arrowreturnthick-1-e"
            }
        });
        $("#tools_line").button({
            icons:{
                primary:"ui-icon-minusthick"
            }
        });
        $("#tools_rectangle").button({
            icons:{
                primary:"ui-icon-stop"
            }
        });
        $("#tools_circle").button({
            icons:{
                primary:"ui-icon-radio-off"
            }
        });
        $("#boldOption").button();
        $("#italicOption").button();

        //4. 画笔粗细设置
        $("#penWidth").selectmenu({
            width:70,
            select:penWidthEventListener
        });

        function penWidthEventListener(event,ui){

            //1. update brash width
            var lineWidth = ui.item.value;
            //ctx.lineWidth =lineWidth;

            //2. update LineTip Width
            //lineTip.css("border-top-width",lineWidth+"px");

            //3.update RectTip width
            //rectTip.css("border-width",lineWidth+"px");
            return false;
        }

        $("#fontSize").selectmenu({
            width:100,
            select:function(event,ui){
                //setFont();
            }
        });

        $("#fontType").selectmenu({
            width:100,
            select:function(event,ui){
                //setFont();
                return false;
            }
        });

        //5. 颜色选择器
        $("#colorpicker-popup").colorpicker({
            buttonColorize: true,
            alpha:          true,
            draggable:       true,
            showOn:         'both',
            close:borderColorEventListener
        });

        $("#colorpicker-font").colorpicker({
            buttonColorize: true,
            alpha:          true,
            draggable:       true,
            showOn:         'both',
            close:fontColorEventListener
        });

        $(".ui-button-text").find("img").attr("src","https://i.imgur.com/ptjJMOT.png");

        $("#penWidth-button").find(".ui-selectmenu-text").bind('DOMNodeInserted',function (e) {
            if($(".imageLabel-drop-now")){
                if(JSON.parse($(".imageLabel-drop-now").attr("data-json")).isRec){
                    var borderColor = "#"+ $("#colorpicker-popup").val();
                    var borderWidth  = $("#penWidth").val()+"px";
                    var sr = borderColor +" "+borderWidth+ " solid";
                    $(".imageLabel-drop-now").css("border",sr);
                    var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                    temp_data.border_width=borderWidth;
                    $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
                }else{
                    var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                    var originalColor=temp_data.border_color;
                    var temp_obj=Object.create(PencilTag);
                    temp_obj.path=temp_data.path;
                    var newWidth=$("#penWidth").val()+"px";
                    temp_data.border_width=newWidth;
                    var current_pic_width=$("#tag-img").css("width");
                    current_pic_width=current_pic_width.substring(0,current_pic_width.length-2);
                    var current_pic_height=$("#tag-img").css("height");
                    current_pic_height=current_pic_height.substring(0,current_pic_height.length-2);
                    var left=temp_data.x*current_pic_width;
                    var right=temp_data.ex*current_pic_width;
                    var top=temp_data.y*current_pic_height;
                    var low=temp_data.ey*current_pic_height;
                    var canvas =  document.getElementById("canvas");
                    var context = canvas.getContext('2d');
                    context.strokeStyle= originalColor;
                    var temp_width= newWidth;
                    context.lineWidth=temp_width.substring(0,temp_width.length-2);
                    context.beginPath();
                    for (var y = 0; y < temp_obj.path.length - 1; y++) {
                        //console.log(temp_obj.path[y].x*current_pic_width+","+temp_obj.path[y].y*current_pic_height);
                        context.moveTo(temp_obj.path[y].x*current_pic_width, temp_obj.path[y].y*current_pic_height);
                        context.lineTo(temp_obj.path[y+1].x*current_pic_width, temp_obj.path[y+1].y*current_pic_height);
                        context.stroke();
                    }
                    var new_image = document.getElementById("test1");
                    new_image.setAttribute("src",canvas.toDataURL());
                    while(!new_image.complete){
                        sleep(50);
                    }
                    //download(canvas);
                    var jietu = document.getElementById("jietu_canvas");
                    jietu.width = right - left + size * 4;
                    jietu.height = low - top + size * 4;
                    var jietu_context = jietu.getContext("2d");
                    jietu_context.drawImage(new_image, left - size*2, top - size*2, right - left + size * 4, low - top + size * 4, 0, 0, right - left + size * 4, low - top + size * 4);
                    var jietu_img = document.getElementById("test2");
                    jietu_img.setAttribute("src",jietu.toDataURL());
                    while(!jietu_img.complete) {
                        sleep(50);
                    }
                    var imgdata = jietu.toDataURL();
                    //download(jietu);
                    context.clearRect(0, 0, canvasWidth, canvasHeight);
                    jietu_context.clearRect(0, 0, jietu.width, jietu.height);
                    $(".imageLabel-drop-now").css({
                        background: "url(" + imgdata + ")"
                    }).attr("data-json", JSON.stringify(temp_data));
                    $(".imageLabel-drop-now").css("background-size", "100% 100%");
                    $(".imageLabel-imgdrop").mouseover(function(event){
                        var is=event.target.getElementsByClassName("imageLable-i-s");
                        is[0].style.display="block";
                    });
                    $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
                }
            }
        });

        $("#fontSize-button").find(".ui-selectmenu-text").bind('DOMNodeInserted',function (e) {
            if($(".imageLabel-drop-now")){
                var fontWidth=$("#fontSize").val();
                $(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("font-size",fontWidth);
                var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                temp_data.font_width=$(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("font-size");
                $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
            }
        });

        $("#ifBold").click(function(e){
            if($(".imageLabel-drop-now")){
                var fontWeight = $("#boldOption").get(0).checked;
                fontWeight = fontWeight ? "bold" : "normal";
                $(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("font-weight",fontWeight);
                var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                temp_data.isbold=$(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("font-weight");
                $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
            }
        });

        function borderColorEventListener(e)
        {
            if($(".imageLabel-drop-now")){
                if(JSON.parse($(".imageLabel-drop-now").attr("data-json")).isRec){
                    var borderColor = "#"+ $("#colorpicker-popup").val();
                    var borderWidth  = $("#penWidth").val()+"px";
                    var sr = borderColor +" "+borderWidth+ " solid";
                    $(".imageLabel-drop-now").css("border",sr);
                    var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                    temp_data.border_width=borderWidth;
                    $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
                }else{
                    var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                    var originalWidth=temp_data.border_width;
                    var temp_obj=Object.create(PencilTag);
                    temp_obj.path=temp_data.path;
                    var newColor="#"+ $("#colorpicker-popup").val();;
                    temp_data.border_color=newColor;
                    var current_pic_width=$("#tag-img").css("width");
                    current_pic_width=current_pic_width.substring(0,current_pic_width.length-2);
                    var current_pic_height=$("#tag-img").css("height");
                    current_pic_height=current_pic_height.substring(0,current_pic_height.length-2);
                    var left=temp_data.x*current_pic_width;
                    var right=temp_data.ex*current_pic_width;
                    var top=temp_data.y*current_pic_height;
                    var low=temp_data.ey*current_pic_height;
                    var canvas =  document.getElementById("canvas");
                    var context = canvas.getContext('2d');
                    context.strokeStyle= newColor;
                    var temp_width= originalWidth;
                    context.lineWidth=temp_width.substring(0,temp_width.length-2);
                    context.beginPath();
                    for (var y = 0; y < temp_obj.path.length - 1; y++) {
                        context.moveTo(temp_obj.path[y].x*current_pic_width, temp_obj.path[y].y*current_pic_height);
                        context.lineTo(temp_obj.path[y+1].x*current_pic_width, temp_obj.path[y+1].y*current_pic_height);
                        context.stroke();
                    }
                    var new_image = document.getElementById("test1");
                    new_image.setAttribute("src",canvas.toDataURL());
                    while(!new_image.complete){
                        sleep(50);
                    }
                    //download(canvas);
                    var jietu = document.getElementById("jietu_canvas");
                    jietu.width = right - left + size * 4;
                    jietu.height = low - top + size * 4;
                    var jietu_context = jietu.getContext("2d");
                    jietu_context.drawImage(new_image, left - size*2, top - size*2, right - left + size * 4, low - top + size * 4, 0, 0, right - left + size * 4, low - top + size * 4);
                    var jietu_img = document.getElementById("test2");
                    jietu_img.setAttribute("src",jietu.toDataURL());
                    while(!jietu_img.complete) {
                        sleep(50);
                    }
                    var imgdata = jietu.toDataURL();
                    context.clearRect(0, 0, canvasWidth, canvasHeight);
                    jietu_context.clearRect(0, 0, jietu.width, jietu.height);
                    $(".imageLabel-drop-now").css({
                        background: "url(" + imgdata + ")"
                    }).attr("data-json", JSON.stringify(temp_data));
                    $(".imageLabel-drop-now").css("background-size", "100% 100%");
                    $(".imageLabel-imgdrop").mouseover(function(event){
                        var is=event.target.getElementsByClassName("imageLable-i-s");
                        is[0].style.display="block";
                    });
                    $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
                }
            }
        }

        function fontColorEventListener(e){
            if($(".imageLabel-drop-now")){
                var fontColor="#"+$("#colorpicker-font").val();
                $(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("color",fontColor);
                var temp_data=JSON.parse($(".imageLabel-drop-now").attr("data-json"));
                temp_data.font_color=$(".imageLabel-drop-now").find(".imageLabel-imgdrop-font").css("color");
                $(".imageLabel-drop-now").attr("data-json", JSON.stringify(temp_data));
            }
        }

        $(".ui-selectmenu-text").css("width","70px");
        $(".ui-selectmenu-text").css("padding-right","15px");
        $(".ui-selectmenu-button").css("width","73px");
        document.getElementById("tools_rectangle").click();
        $.jsPanel({
            selector: '#workspace',
            bootstrap: 'warning',
            draggable: {
                containment: "parent"
            },
            title: '整体描述区域',
            resizable: false,
            autoload: true,
            position: {left: 0, top: 76},
            headerControls: {
                buttons: true,
                close: false,
                maximize: false,
                minimize: false,
                normalize: false,
                smallify: false
            },
            callback:function(){
                var content=$(".jsPanel-content");
                var new_div="<div class=\"row\" style=\"text-align: center\">\n" +
                    "                        <h3 class=\"demand_name_h3\" style='margin-right: auto;margin-left: auto;padding-top: 10px;padding-bottom: 10px'><span>...在此区域添加整体描述...</span></h3>\n" +
                    "                    </div>";
                var new_elem="<div style=\"width: 100%;height: 70%;position: absolute;\">\n" +
                    "        <textarea name=\"field2\" class='input-area' id=\"field2\" placeholder='在此处添加该图片的整体描述...' style=\"margin-left: auto;margin-right: auto;width: 90%;height: 100%;\"></textarea>\n" +
                    "        <div class=\"arrow\" id='top_right' style=\"position:absolute;right: 20px;top: 0px\"></div>\n" +
                    "    </div>";
                content.append(new_div);
                content.append(new_elem);
                var width=document.getElementById("field2").style.width;
                width=width.substring(0,width.length-2);
                document.getElementById("field2").style.width=(width-40)+"px";
                var up_btn="<i class=\"fas fa-angle-double-up\" id='up' style='font-size: 20px;margin-right:20px;color: black;cursor: pointer'></i>";
                var down_btn="<i class=\"fas fa-angle-double-down\" id='down' style='font-size: 20px;margin-right: 20px;color: black;display: none;cursor: pointer'></i>";
                $(".jsPanel-hdr-r").append(up_btn);
                $(".jsPanel-hdr-r").append(down_btn);
                $("#up").click(function(){
                    $(".jsPanel-content").css("display","none");
                    $("#down").css("display","block");
                    $("#up").css("display","none");
                });
                $("#down").click(function(){
                    $(".jsPanel-content").css("display","block");
                    $("#down").css("display","none");
                    $("#up").css("display","block");
                });
            }
        });
    });
    function out_alert() {
        $.alert({
            title: '提醒',
            content: '单击右侧提交按钮，可以提交此批图片，更换该项目的下一批图片，提交后不能修改，提交时会抽样检查您此批图片完成的情况，完成不合格将不允许您提交此次完成结果',
            confirmButton: '确认',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right'
        })
    }
    function come_next(){
        $.confirm({
            title: '提交',
            content: '提交这批图片可以更换下一批图片,提交后将无法修改这批图片的标注结果，是否确认提交这批图片',
            confirmButton: '确认',
            cancelButton: '取消',
            confirmButtonClass: 'btn-info',
            icon: 'fa fa-question-circle',
            animation: 'rotate',
            closeAnimation: 'right',
            confirm:function(){
                //检测这批图片的准确性
                if(true){
                    //选择一下现在正在工作的这张图片，来存储这张图片的标注信息
                    choosePic(urls[current_picture],current_picture);

                    //1.随后对数据的图片进行更新
                    var pics=[];
                    for(var i=0;i<ProjectInfo.length;i++){
                        var temp={};
                        //ProjectInfo[i].pictureTotalDes
                        temp.aroundDesc=ProjectInfo[i].pictureTotalDes;
                        //ProjectInfo[i].pencilOfPic
                        temp.pencilTag=ProjectInfo[i].pencilOfPic;
                        //ProjectInfo[i].recOfPic
                        temp.recTag=ProjectInfo[i].recOfPic;
                        temp.url=ProjectInfo[i].pictureURL.substring(7);
                        pics.push(temp);
                    }

                    var temp_data={pid:project_id,uid:user_id,pictures:pics};

                    //2.进行最终的保存
                    $.ajax({
                        type : 'POST',
                        url : '/personalTag/update',
                        contentType:"application/json",
                        dataType:"json",
                        data :JSON.stringify(temp_data),
                        success : function (data) {
                            // $.alert({
                            //     title: '系统已自动保存修改结果！',
                            //     content: '保存成功 <br> ',
                            //     confirmButton: '我知道了',
                            //     confirmButtonClass: 'btn-primary',
                            //     icon: 'fa fa-info',
                            //     animation: 'rotate',
                            //     closeAnimation: 'right',
                            //     opacity: 0.5
                            // });
                        },
                        error: function (data) {
                            // $.alert({
                            //     title: '保存本次修改结果失败！',
                            //     content: '由于某些不知名的原因，项目修改结果保存失败，请尝试重新保存',
                            //     confirmButton: '重新保存',
                            //     confirmButtonClass: 'btn-primary',
                            //     icon: 'fa fa-info',
                            //     animation: 'rotate',
                            //     closeAnimation: 'right',
                            //     opacity: 0.5,
                            // });
                        }
                    });
                    $.ajax({
                        type : 'POST',
                        url : '/personalTag/getNext',
                        async:false,
                        data :{username:JSON.parse(localStorage.getItem("current_user")).username,projectID:localStorage.getItem("work_id")},
                        success : function (result) {
                            var urls=new Array();
                            if(result.length>0) {
                                ProjectInfo=[];
                                // alert(JSON.stringify(ProjectInfo));
                                var temp=[];
                                var new_pencils=new Array();
                                var new_recs=new Array();
                                var new_des=new Array();
                                for (var i = 0; i < result.length; i++) {
                                    urls.push("http://" + result[i]);
                                    new_pencils.push(temp);
                                    new_recs.push(temp);
                                    new_des.push(null);
                                }
                                pictures = urls;
                                pencils = new_pencils;
                                rectangles = new_recs;
                                des = new_des;
                                document.getElementsByClassName("scrollbot-inner-parent")[0].innerHTML="";
                                new_addPic();
                            }else{
                                $.alert({
                                    title: '已全部完成',
                                    content: '当前项目的图片已全部完成，您可以返回项目详细信息页面提交该项目',
                                    confirmButton: '确认',
                                    confirmButtonClass: 'btn-info',
                                    icon: 'fa fa-question-circle',
                                    animation: 'rotate',
                                    closeAnimation: 'right'
                                })
                            }
                        },
                        error: function (result) {
                            alert("读取项目出错")
                        }
                    });
                }else{

                }
            }
        })
    }
</script>

<script src="/js/scrollbot.js" type="text/javascript"></script>
<script  src="/js/scrollreveal.min.js" type="text/javascript"></script>
<script>
    custom2 = new scrollbot(".custom-scroll-2",10).setStyle({
        "background":"#202020",
        "z-index":"2"
    },{
        "background":"rgba(0,0,0,0)"
    });
    var psuedo = document.createElement("div");
    psuedo.style.cssText = "height:100%;width:2px;left:4px;background:#808080;position:absolute;z-index:1";
    custom2.scrollBarHolder.appendChild(psuedo);

    document.onreadystatechange = function(){
        custom2.refresh();
    }
</script>


</body>
</html>